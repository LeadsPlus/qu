{"name":"Qu","body":"# Qu\r\n\r\nQu is a Ruby library for queuing and processing background jobs. It is heavily inspired by delayed_job and Resque.\r\n\r\nQu was created to overcome some shortcomings in the existing queuing libraries that we experienced at [Ordered List](http://orderedlist.com) while building [SpeakerDeck](http://speakerdeck.com), [Gaug.es](http://get.gaug.es) and [Harmony](http://get.harmonyapp.com). The advantages of Qu are:\r\n\r\n* Multiple backends (redis, mongo)\r\n* Jobs are requeued when worker is killed\r\n* Resque-like API\r\n\r\n## Information & Help\r\n\r\n* Find more information on the [Wiki](https://github.com/bkeepers/qu/wiki).\r\n* Post to the [Google Group](http://groups.google.com/group/qu-users) for help or questions.\r\n* See the [issue tracker](https://github.com/bkeepers/qu/issues) for known issues or to report an issue.\r\n\r\n## Installation\r\n\r\n### Rails 3\r\n\r\nDecide which backend you want to use and add the gem to your `Gemfile`.\r\n\r\n``` ruby\r\ngem 'qu-redis'\r\n```\r\n\r\nThat's all you need to do!\r\n\r\n### Rails 2\r\n\r\nDecide which backend you want to use and add the gem to `config.gems` in `environment.rb`:\r\n\r\n``` ruby\r\nconfig.gem 'qu-redis'\r\n````\r\n\r\nTo load the rake tasks, add the following to your `Rakefile`:\r\n\r\n``` ruby\r\nrequire 'qu/tasks'\r\n```\r\n\r\n## Usage\r\n\r\nJobs are any class that responds to the `.perform` method:\r\n\r\n``` ruby\r\nclass ProcessPresentation\r\n  def self.perform(presentation_id)\r\n    presentation = Presentation.find(presentation_id)\r\n    presentation.process!\r\n  end\r\nend\r\n```\r\n\r\nYou can add a job to the queue by calling the `enqueue` method:\r\n\r\n``` ruby\r\njob = Qu.enqueue ProcessPresentation, @presentation.id\r\nputs \"Enqueued job #{job.id}\"\r\n```\r\n\r\nAny additional parameters passed to the `enqueue` method will be passed on to the `perform` method of your job class. These parameters will be stored in the backend, so they must be simple types that can easily be serialized and unserialized. So don't try to pass in an ActiveRecord object.\r\n\r\nProcessing the jobs on the queue can be done with a Rake task:\r\n\r\n``` sh\r\n$ bundle exec rake qu:work\r\n```\r\n\r\nYou can easily inspect the queue or clear it:\r\n\r\n``` ruby\r\nputs \"Jobs on the queue:\", Qu.length\r\nQu.clear\r\n```\r\n\r\n### Queues\r\n\r\nThe `default` queue is used, um…by default. Jobs that don't specify a queue will be placed in that queue, and workers that don't specify a queue will work on that queue.\r\n\r\nHowever, if you have some background jobs that are more or less important, or some that take longer than others, you may want to consider using multiple queues. You can have workers dedicated to specific queues, or simply tell all your workers to work on the most important queue first.\r\n\r\nJobs can be placed in a specific queue by setting the queue variable:\r\n\r\n``` ruby\r\nclass CallThePresident\r\n  @queue = :urgent\r\n\r\n  def self.perform(message)\r\n    # …\r\n  end\r\nend\r\n```\r\n\r\nYou can then tell workers to work on this queue by passing an environment variable\r\n\r\n``` sh\r\n$ bundle exec rake qu:work QUEUES=urgent,default\r\n```\r\n\r\nNote that if you still want your worker to process the default queue, you must specify it. Queues will be process in the order they are specified.\r\n\r\nYou can also get the length or clear a specific queue:\r\n\r\n``` ruby\r\nQu.length(:urgent)\r\nQu.clear(:urgent)\r\n```\r\n\r\n## Configuration\r\n\r\nMost of the configuration for Qu should be automatic. It will also automatically detect ENV variables from Heroku for backend connections, so you shouldn't need to do anything to configure the backend.\r\n\r\nHowever, if you do need to customize it, you can by calling the `Qu.configure`:\r\n\r\n``` ruby\r\nQu.configure do |c|\r\n  c.connection  = Redis::Namespace.new('myapp:qu', :redis => Redis.connect)\r\n  c.logger      = Logger.new('log/qu.log')\r\nend\r\n```\r\n\r\n## Tests\r\n\r\nIf you prefer to have jobs processed immediatly in your tests, there is an `Immediate` backend that will perform the job instead of enqueuing it. In your test helper, require qu-immediate:\r\n\r\n``` ruby\r\nrequire 'qu-immediate'\r\n```\r\n\r\n## Why another queuing library?\r\n\r\nResque and delayed_job are both great, but both of them have shortcomings that can be frustrating in production applications.\r\n\r\ndelayed_job was a brilliantly simple pioneer in the world of database-backed queues. While most asynchronous queuing systems were tending toward overly complex, it made use of your existing database and just worked. But there are a few flaws:\r\n\r\n* Occasionally fails silently.\r\n* Use of priority instead of separate named queues.\r\n* Contention in the ActiveRecord backend with multiple workers. Occasionally the same job gets performed by multiple workers.\r\n\r\nResque, the wiser relative of delayed_job, fixes most of those issues. But in doing so, it forces some of its beliefs on you, and sometimes those beliefs just don't make sense for your environment. Here are some of the flaws of Resque:\r\n\r\n* Redis is a great queue backend, but it doesn't make sense for every environment.\r\n* Workers lose jobs when they are forced to quit. This has especially been an issue on Heroku.\r\n* Forking before each job prevents memory leaks, but it is terribly inefficient in environments with a lot of fast jobs (the resque-jobs-per-fork plugin alleviates this)\r\n\r\nThose shortcomings lead us to write Qu. It is not perfect, but we hope to overcome the issues we faced with other queuing libraries.\r\n\r\n## Contributing\r\n\r\nIf you find what looks like a bug:\r\n\r\n1. Search the [mailing list](http://groups.google.com/group/qu-users) to see if anyone else had the same issue.\r\n2. Check the [GitHub issue tracker](http://github.com/bkeepers/qu/issues/) to see if anyone else has reported issue.\r\n3. If you don't see anything, create an issue with information on how to reproduce it.\r\n\r\nIf you want to contribute an enhancement or a fix:\r\n\r\n1. Fork the project on GitHub.\r\n2. Make your changes with tests.\r\n3. Commit the changes without making changes to the Rakefile, Gemfile, gemspec, or any other files that aren't related to your enhancement or fix\r\n4. Send a pull request.\r\n","tagline":"a Ruby library for queuing and processing background jobs.","google":""}